
trigger:
- master
variables:
- group: uipath-cicd
- name: agent.preferPowerShellOnContainers
  value: 'True'

pool:
  vmImage: 'windows-latest'
container:
  image: uipathcicddemo.azurecr.io/renegadejediuipathdockerdevops:23
  endpoint: uipathcicddemo
steps:
- script: C:\UiPath\UiRobot.exe pack $(Build.SourcesDirectory)\project.json -o $(Build.ArtifactStagingDirectory)\ -v 1.0.$(Build.BuildNumber)
  displayName: 'Build the artifact'
- publish: $(Build.ArtifactStagingDirectory)
  artifact: drop
- powershell: |
    Import-Module UiPath.PowerShell
    $token = Get-UiPathAuthToken -ClientId $(clientId_TK_DEV) -UserKey $(userKey_TK_DEV) -AccountName $(accountName_TK_DEV) -CloudDeployment 'Production' -TenantName $(tenantName_TK_DEV)
    Add-UiPathPackage -PackageFile $(Build.ArtifactStagingDirectory)\TestMessageBoxOnlyProcess.$(Build.BuildNumber).nupkg -AuthToken $token

